{% extends 'base.html' %}

{% block title %}Главная - Сервис рассылок{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1 class="mb-4">Добро пожаловать в сервис рассылок!</h1>

        <!-- Статистика -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card text-white bg-primary">
                    <div class="card-body">
                        <h5 class="card-title">Всего рассылок</h5>
                        <p class="card-text display-4">{{ total_mailings }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-success">
                    <div class="card-body">
                        <h5 class="card-title">Активных рассылок</h5>
                        <p class="card-text display-4">{{ active_mailings }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-info">
                    <div class="card-body">
                        <h5 class="card-title">Уникальных клиентов</h5>
                        <p class="card-text display-4">{{ total_clients }}</p>
                    </div>
                </div>
            </div>
        </div>

        {% if user.is_authenticated %}
            <!-- Последние рассылки пользователя -->
            <h2 class="mb-3">Ваши последние рассылки</h2>
            {% if mailings %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Сообщение</th>
                                <th>Дата начала</th>
                                <th>Дата окончания</th>
                                <th>Статус</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for mailing in mailings|slice:":5" %}
                                <tr>
                                    <td>{{ mailing.id }}</td>
                                    <td>{{ mailing.message.subject }}</td>
                                    <td>{{ mailing.start_time|date:"d.m.Y H:i" }}</td>
                                    <td>{{ mailing.end_time|date:"d.m.Y H:i" }}</td>
                                    <td>
                                        {% if mailing.status == 'created' %}
                                            <span class="badge bg-secondary">Создана</span>
                                        {% elif mailing.status == 'started' %}
                                            <span class="badge bg-success">Запущена</span>
                                        {% else %}
                                            <span class="badge bg-danger">Завершена</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{% url 'mailings:mailing_detail' mailing.pk %}" class="btn btn-sm btn-info">Просмотр</a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-muted">У вас пока нет рассылок. <a href="{% url 'mailings:mailing_create' %}">Создайте первую!</a></p>
            {% endif %}

            <!-- Быстрые действия -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <h3>Быстрые действия</h3>
                    <a href="{% url 'mailings:client_create' %}" class="btn btn-primary">Добавить клиента</a>
                    <a href="{% url 'mailings:message_create' %}" class="btn btn-primary">Создать сообщение</a>
                    <a href="{% url 'mailings:mailing_create' %}" class="btn btn-success">Создать рассылку</a>
                </div>
            </div>
        {% else %}
            <!-- Для неавторизованных пользователей -->
            <div class="alert alert-info">
                <h4 class="alert-heading">Добро пожаловать!</h4>
                <p>Для работы с сервисом необходимо <a href="{% url 'users:login' %}">войти</a> или <a href="{% url 'users:register' %}">зарегистрироваться</a>.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}